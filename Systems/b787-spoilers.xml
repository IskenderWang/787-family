<?xml version="1.0" encoding="UTF-8"?>

<!-- Boeing 787 speedbrake/ground spoiler configuration -->

<PropertyList>

    <logic>
        <name>Ground spoilers disarm</name>
        <enable>
            <condition>
                <!-- Ground spoilers can only be armed when the speedbrake lever is up -->
                <greater-than>
                    <property>/controls/flight/speedbrake-lever</property>
                    <value>0</value>
                </greater-than>
            </condition>
        </enable>
        <input>
            <false />
        </input>
        <output>/controls/flight/ground-spoilers-armed</output>
    </logic>

    <logic>
        <name>Ground spoilers engage</name>
        <enable>
            <condition>
                <equals>
                    <property>/controls/flight/ground-spoilers-armed</property>
                    <value type="bool">true</value>
                </equals>
                <equals>
                    <property>/controls/engines/throttle-cmd-pid</property>
                    <value type="double">0</value>
                </equals>
                <property>/gear/gear[1]/wow</property>
                <property>/gear/gear[2]/wow</property>
                <greater-than>
                    <property>/instrumentation/airspeed-indicator/indicated-speed-kt</property>
                    <value>72</value>
                </greater-than>
            </condition>
        </enable>
        <input>
            <true />
        </input>
        <output>/controls/flight/ground-spoilers</output>
    </logic>

    <logic>
        <name>Ground spoilers disengage</name>
        <enable>
            <condition>
                <or>
                    <equals>
                        <property>/controls/flight/ground-spoilers-armed</property>
                        <value type="bool">false</value>
                    </equals>
                    <less-than>
                        <property>/instrumentation/airspeed-indicator/indicated-speed-kt</property>
                        <value>72</value>
                    </less-than>
                </or>
            </condition>
        </enable>
        <input>
            <false />
        </input>
        <output>/controls/flight/ground-spoilers</output>
    </logic>

    <filter>
        <name>Main speedbrake controller</name>
        <type>gain</type>
        <gain>1.0</gain>
        <input>
            <expression>
                <max>
                    <property>/controls/flight/ground-spoilers</property>
                    <property>/controls/flight/speedbrake-lever</property>
                </max>
            </expression>
        </input>
        <output>/controls/flight/speedbrake</output>
    </filter>

    <filter>
        <name>CAC inlet deflector controller</name>
        <type>gain</type>
        <gain>1.0</gain>
        <input>
            <condition>
                <and>
                    <not>
                        <equals>
                            <property>/gear/gear[1]/wow</property>
                            <value>true</value>
                        </equals>
                    </not>
                    <equals>
                        <property>/controls/gear/gear-down</property>
                        <value>true</value>
                    </equals>
                    <greater-than-equals>
                        <property>/controls/flight/flaps</property>
                        <value>0.833</value>
                    </greater-than-equals>
                </and>
            </condition>
            <value>1</value>
        </input>
        <input>
            <condition>
                <and>
                    <equals>
                        <property>/gear/gear[1]/wow</property>
                        <value>true</value>
                    </equals>
                    <greater-than-equals>
                        <property>/environment/temperature-degc</property>
                        <value>2</value>
                    </greater-than-equals>
                    <less-than-equals>
                        <property>/environment/temperature-degc</property>
                        <value>35</value>
                    </less-than-equals>
                </and>
            </condition>
            <value>1</value>
        </input>
        <input>
            <condition>
                <and>
                    <equals>
                        <property>/gear/gear[1]/wow</property>
                        <value>true</value>
                    </equals>
                    <greater-than>
                        <property>/environment/temperature-degc</property>
                        <value>35</value>
                    </greater-than>
                    <or>
                        <greater-than-equals>
                            <property>/engines/engine[0]/n2</property>
                            <value>50.0</value>
                        </greater-than-equals>
                        <greater-than-equals>
                            <property>/engines/engine[1]/n2</property>
                            <value>50.0</value>
                        </greater-than-equals>
                    </or>
                    <or>
                        <less-than>
                            <property>/engines/engine[0]/n2</property>
                            <value>90.0</value>
                        </less-than>
                        <less-than>
                            <property>/engines/engine[1]/n2</property>
                            <value>90.0</value>
                        </less-than>
                    </or>
                </and>
            </condition>
            <value>0.5</value>
        </input>
        <input>0</input>
        <output>/systems/cac/inlet-deflector-door-cmd</output>
    </filter>

    <filter>
        <name>CAC inlet deflector position</name>
        <type>noise-spike</type>
        <input>/systems/cac/inlet-deflector-door-cmd</input>
        <output>/systems/cac/inlet-deflector-door-pos</output>
        <max-rate-of-change>1</max-rate-of-change>
    </filter>

</PropertyList>