<?xml version="1.0" encoding="UTF-8"?>

<!-- Put anything common between all -sets here -->

<PropertyList>

    <controls>
        <gear>
            <tiller-cmd-norm type="double">0</tiller-cmd-norm>
            <steering-cmd-norm type="double">0</steering-cmd-norm>
            <enable-tiller type="bool">false</enable-tiller>
            <brake-parking type="bool">true</brake-parking>
        </gear>
    </controls>

    <input>
        <keyboard>
            <key n="267">
                <name>F11</name>
                <desc>Pop up autopilot dialog</desc>
                <binding>
                    <command>nasal</command>
                    <script>
							 var ap_dialog = gui.Dialog.new("sim/gui/dialogs/ap_dialog/dialog", "Aircraft/787-family/gui/dialogs/it-autoflight-dlg.xml");
							 ap_dialog.open();
							</script>
                </binding>
            </key>
            <key n="127">
                <name>Delete</name>
                <desc>Toggle thrust reversers</desc>
                <binding>
                    <command>nasal</command>
                    <script>
					 reversethrust.togglereverser();
					</script>
                </binding>
            </key>
            <key n="101">
                <name>e</name>
                <desc>Set idle thrust</desc>
                <binding>
                    <command>nasal</command>
                    <script>
                        if (getprop("/it-autoflight/input/athr") == 1) {
                            setprop("/it-autoflight/input/athr", 0);
                        }
                        setprop("controls/engines/engine[0]/throttle", 0);
                        setprop("controls/engines/engine[1]/throttle", 0);
                    </script>
                </binding>
            </key>
            <key n="114">
                <name>r</name>
                <desc>Set TOGA thrust</desc>
                <binding>
                    <command>nasal</command>
                    <script>
                        if (getprop("/it-autoflight/input/athr") == 1) {
                            setprop("/it-autoflight/input/athr", 0);
                        }
                        setprop("controls/engines/engine[0]/throttle", 1);
                        setprop("controls/engines/engine[1]/throttle", 1);
                    </script>
                </binding>
            </key>
            <key n="6">
                <name>Ctrl-f</name>
                <desc>Toggle FBW Override</desc>
                <repeatable type="bool">true</repeatable>
                <binding>
                    <command>property-cycle</command>
                    <property>/controls/fbw/active</property>
                    <value>0</value>
                    <value>1</value>
                </binding>
            </key>
            <key n="25">
                <name>Ctrl-y</name>
                <desc>Toggle Yaw Damper</desc>
                <repeatable type="bool">true</repeatable>
                <binding>
                    <command>property-cycle</command>
                    <property>/controls/fbw/yaw-damper</property>
                    <value>0</value>
                    <value>1</value>
                </binding>
            </key>
            <key n="119">
                <name>w</name>
                <desc>Walk forward toward view</desc>
                <repeatable type="bool">true</repeatable>
                <binding>
                    <command>nasal</command>
                    <script>
					 walk.walk_about(0.1);
					</script>
                </binding>
            </key>
            <key n="2">
                <name>Ctrl-b</name>
                <desc>Cycle speedbrake setting</desc>
                <binding>
                    <command>nasal</command>
                    <script><![CDATA[
                        var lever = "controls/flight/speedbrake-lever";
                        var auto = "controls/flight/speedbrake-auto";

                        if (getprop(auto) == 1) {
                            setprop(lever, 0.0);
                            setprop(auto, 0);
                            return;
                        }

                        var setting = getprop(lever) + 0.5;
                        if (setting > 1) {
                            setting = 0;
                        }
                        setprop(lever, setting);
                        ]]></script>
                </binding>
            </key>
            <key n="11">
                <name>Ctrl-k</name>
                <desc>Arm/disarm ground spoilers</desc>
                <binding>
                    <command>property-toggle</command>
                    <property>controls/flight/ground-spoilers-armed</property>
                </binding>
            </key>
            <key n="87">
                <name>W</name>
                <desc>Run forward toward view</desc>
                <repeatable type="bool">true</repeatable>
                <binding>
                    <command>nasal</command>
                    <script>
					 walk.walk_about(0.25);
					</script>
                </binding>
            </key>
            <key n="115">
                <name>s</name>
                <desc>Walk backward from view</desc>
                <repeatable type="bool">true</repeatable>
                <binding>
                    <command>nasal</command>
                    <script>
					 walk.walk_about(-0.1);
					</script>
                </binding>
            </key>
            <key n="357">
                <name>Up</name>
                <repeatable type="bool">true</repeatable>
                <mod-alt>
                    <desc>Tilt View Up</desc>
                    <binding>
                        <command>nasal</command>
                        <script>
						setprop("/sim/current-view/pitch-offset-deg", getprop("/sim/current-view/pitch-offset-deg") + 1);
					</script>
                    </binding>
                </mod-alt>
            </key>
            <key n="359">
                <name>Down</name>
                <repeatable type="bool">true</repeatable>
                <mod-alt>
                    <desc>Tilt View Down</desc>
                    <binding>
                        <command>nasal</command>
                        <script>
						setprop("/sim/current-view/pitch-offset-deg", getprop("/sim/current-view/pitch-offset-deg") - 1);
					</script>
                    </binding>
                </mod-alt>
            </key>
            <key n="356">
                <name>Left</name>
                <repeatable type="bool">true</repeatable>
                <mod-alt>
                    <desc>Pan View Left</desc>
                    <binding>
                        <command>nasal</command>
                        <script>
						setprop("/sim/current-view/heading-offset-deg", getprop("/sim/current-view/heading-offset-deg") + 1);
					</script>
                    </binding>
                </mod-alt>
            </key>
            <key n="358">
                <name>Right</name>
                <repeatable type="bool">true</repeatable>
                <mod-alt>
                    <desc>Pan View Right</desc>
                    <binding>
                        <command>nasal</command>
                        <script>
						setprop("/sim/current-view/heading-offset-deg", getprop("/sim/current-view/heading-offset-deg") - 1);
					</script>
                    </binding>
                </mod-alt>
            </key>
            <key n="66">
                <name>B</name>
                <desc>Toggle parking brake on or off</desc>
                <binding>
                    <command>nasal</command>
                    <script>b787.toggle_parkingbrakes();</script>
                </binding>
            </key>
            <key n="68">
                <name>D</name>
                <desc>Autopilot Disconnect</desc>
                <binding>
                    <command>property-assign</command>
                    <property>it-autoflight/input/ap1</property>
                    <value>0</value>
                </binding>
            </key>
        </keyboard>
    </input>

    <sim n="0">
        <aircraft-data>
            <path>/sim/model/autopush/route/show</path>
            <path>/sim/model/autopush/route/show-wingtip</path>
        </aircraft-data>
        <model>
            <autopush include="Systems/autopush-config.xml" />
        </model>
        <systems>
            <autopilot>
                <name>IT-AUTOFLIGHT</name>
                <path>Aircraft/787-family/Systems/it-autoflight.xml</path>
            </autopilot>
            <autopilot>
                <name>IT-AUTOTHRUST</name>
                <path>Aircraft/787-family/Systems/it-autothrust.xml</path>
            </autopilot>
            <autopilot>
                <name>Gear AGL FT</name>
                <path>Aircraft/787-family/Systems/gear-agl-ft.xml</path>
            </autopilot>

            <wingflexer include="Systems/wingflexer-params.xml" />
            <autopilot>
                <name>wing flexer property rule</name>
                <path>Aircraft/Generic/wingflexer.xml</path>
            </autopilot>

            <autopilot>
                <name>Spoilers</name>
                <path>Aircraft/787-family/Systems/b787-spoilers.xml</path>
            </autopilot>

            <autopilot>
                <name>Nose wheel steering</name>
                <path>Aircraft/787-family/Systems/ground_steering.xml</path>
            </autopilot>

            <autopilot>
                <name>Windscreen cracker at excessive Gs</name>
                <path>Aircraft/787-family/Systems/limits.xml</path>
            </autopilot>
        </systems>
        <flight-recorder include="Systems/flight-recorder.xml"></flight-recorder>
    </sim>

    <fdm>
        <jsbsim>
            <external_reactions>
                <tractor>
                    <magnitude alias="/sim/model/autopush/force-lbf" />
                    <x alias="/sim/model/autopush/force-x" />
                    <y alias="/sim/model/autopush/force-y" />
                    <z alias="/sim/model/autopush/force-z" />
                </tractor>
            </external_reactions>
        </jsbsim>
    </fdm>

    <gear>
        <gear n="0">
            <tyre-smoke type="bool">0</tyre-smoke>
            <sprayspeed-ms type="double">0</sprayspeed-ms>
            <spray-density type="double">0</spray-density>
            <caster-angle-deg-damped type="double">0</caster-angle-deg-damped>
        </gear>
        <gear n="1">
            <tyre-smoke type="bool">0</tyre-smoke>
            <sprayspeed-ms type="double">0</sprayspeed-ms>
            <spray-density type="double">0</spray-density>
            <caster-angle-deg-damped type="double">0</caster-angle-deg-damped>
        </gear>
        <gear n="2">
            <tyre-smoke type="bool">0</tyre-smoke>
            <sprayspeed-ms type="double">0</sprayspeed-ms>
            <spray-density type="double">0</spray-density>
            <caster-angle-deg-damped type="double">0</caster-angle-deg-damped>
        </gear>
    </gear>

    <nasal>
        <autopush>
            <file>Nasal/Autopush/autopush.nas</file>
        </autopush>
        <autopush_driver>
            <file>Nasal/Autopush/driver.nas</file>
        </autopush_driver>
        <dynarr>
            <file>Nasal/Autopush/dynarr.nas</file>
        </dynarr>
        <autopush_route>
            <file>Nasal/Autopush/route.nas</file>
        </autopush_route>
    </nasal>

    <it-autoflight>
        <config>
            <roll>
                <kp-low>0.18</kp-low> <!-- Kp at low speed -->
                <kp-high>0.09</kp-high> <!-- Kp at high speed -->
                <ti>1.0</ti>
                <td>0.0001</td>
            </roll>
            <pitch>
                <kp-low>-0.17</kp-low> <!-- Kp at low speed -->
                <kp-high>-0.07</kp-high> <!-- Kp at high speed -->
                <ti>0.5</ti>
                <td>0.001</td>
            </pitch>
            <cmd>
                <roll>1.6</roll>
                <alt-gain>-5</alt-gain>
            </cmd>
            <autoland>
                <pitch-kp>0.0051</pitch-kp>
                <yaw-kp>-0.05</yaw-kp>
            </autoland>
            <rollout>
                <roll-kp>-0.1</roll-kp>
                <pitch-nose>0.1</pitch-nose>
                <pitch-rate>-1.5</pitch-rate>
                <yaw-kp>-0.02</yaw-kp>
            </rollout>
        </config>
        <settings>
            <autoland-without-ap>0</autoland-without-ap> <!-- Engage LAND and FLARE Modes even if the AP is off -->
            <auto-bank-max-deg>30</auto-bank-max-deg> <!-- Maximum Auto Bank Limit -->
            <autothrottle-max>0.95</autothrottle-max> <!-- Thrust Max Limit Normalized -->
            <autothrottle-min>0.02</autothrottle-min> <!-- Thrust Low Limit Normalized -->
            <custom-fma>0</custom-fma> <!-- Call functions when modes change for a custom FMA to be implemented -->
            <disable-final>0</disable-final> <!-- Disable the Final Controllers, for custom FCS integration -->
            <hdg-hld-separate>0</hdg-hld-separate> <!-- Separates the HDG HLD mode from the HDG SEL mode -->
            <land-enable>1</land-enable> <!-- Enable/Disable Autoland -->
            <land-flap>0.7</land-flap> <!-- Minimum Flap used for Landing -->
            <lat-agl-ft>50</lat-agl-ft> <!-- AGL when LNAV becomes active if armed -->
            <reduc-agl-ft>1000</reduc-agl-ft> <!-- AGL when T/O CLB changes to SPD CLB (FLCH), set to 0 to disable -->
            <retard-enable>1</retard-enable> <!-- AGL to Thrust Retard -->
            <retard-ft>50</retard-ft> <!-- Enable Thrust Retard -->
            <togaspd>160</togaspd> <!-- V2 + 10kts -->
        </settings>
    </it-autoflight>

</PropertyList>
